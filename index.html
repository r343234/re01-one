import sys
from PyQt5.QtWidgets import QApplication, QMainWindow, QStatusBar, QLabel, QDockWidget, QWidget, QPushButton, QSlider, QVBoxLayout, QHBoxLayout, QMenu, QDialog
from PyQt5.QtCore import Qt, QTimer
from PyQt5.QtGui import QFont
from PyQt5.QtMultimedia import QSound

class VoiceControlDialog(QDialog):
    def __init__(self):
        super().__init__()
        self.setWindowTitle("è¯­éŸ³æ§åˆ¶ç•Œé¢")
        self.setGeometry(200, 200, 300, 200)
        layout = QVBoxLayout()

        # è¯´æ˜æ–‡å­—
        instruction_label = QLabel("æŒ‰ä½ä¸‹æ–¹æŒ‰é’®è¯´è¯ï¼Œæ¾å¼€åè¯­éŸ³æŒ‡ä»¤å°†è¢«å‘é€ã€‚")
        instruction_label.setStyleSheet("font-size: 14px; color: #333;")
        layout.addWidget(instruction_label)

        # æŒ‰ä½è¯´è¯æŒ‰é’®
        self.speak_button = QPushButton("æŒ‰ä½è¯´è¯")
        self.speak_button.setStyleSheet("""
            QPushButton {
                background-color: #007BFF;
                color: white;
                border-radius: 5px;
                padding: 10px;
                border: none;
                box-shadow: 2px 2px 4px rgba(0, 0, 0, 0.3);
            }
            QPushButton:hover {
                background-color: #0056b3;
            }
            QPushButton:pressed {
                background-color: #003d82;
                box-shadow: 1px 1px 2px rgba(0, 0, 0, 0.3);
            }
        """)
        layout.addWidget(self.speak_button)

        self.setLayout(layout)

class GestureControlDialog(QDialog):
    def __init__(self):
        super().__init__()
        self.setWindowTitle("æ‰‹åŠ¿æ§åˆ¶ç•Œé¢")
        self.setGeometry(200, 200, 300, 200)
        layout = QVBoxLayout()
        label = QLabel("æ‰‹åŠ¿æ§åˆ¶è¯´æ˜ï¼š\nå¯ä»¥é€šè¿‡ç‰¹å®šæ‰‹åŠ¿æ§åˆ¶æ— äººæœºçš„é£è¡Œã€‚\nä¾‹å¦‚ï¼šå‘ä¸ŠæŒ¥æ‰‹ï¼Œæ— äººæœºä¼šä¸Šå‡ã€‚")
        label.setStyleSheet("font-size: 14px; color: #333;")
        layout.addWidget(label)
        self.setLayout(layout)

class MainWindow(QMainWindow):
    def __init__(self):
        super().__init__()

        # é¡¶éƒ¨çŠ¶æ€æ 
        self.status_bar = QStatusBar()
        self.status_bar.setStyleSheet("background-color: #343A40; color: white; padding: 5px;")
        self.connection_label = QLabel("å·²è¿æ¥")
        self.battery_label = QLabel("ğŸ”‹ 80%")
        self.wifi_label = QLabel("ğŸ“¶ Strong")
        self.mode_label = QLabel("æ‰‹åŠ¿æ§åˆ¶ä¸­")
        self.status_bar.addWidget(self.connection_label)
        self.status_bar.addWidget(self.battery_label)
        self.status_bar.addWidget(self.wifi_label)
        self.status_bar.addWidget(self.mode_label)
        self.setStatusBar(self.status_bar)

        # ä¸­å¤®è§†é¢‘æ˜¾ç¤ºåŒºåŸŸ
        self.video_label = QLabel()
        self.video_label.setStyleSheet("background-color: #1E1E1E; margin: 10px; border-radius: 10px; border: 2px solid #343A40;")
        self.setCentralWidget(self.video_label)

        # å·¦ä¾§æ§åˆ¶é¢æ¿
        self.left_dock = QDockWidget("æ§åˆ¶é¢æ¿")
        self.left_panel = QWidget()
        left_layout = QVBoxLayout()
        left_layout.setSpacing(10)
        left_layout.setContentsMargins(10, 10, 10, 10)

        # åŸºç¡€æ§åˆ¶æŒ‰é’®
        self.takeoff_btn = QPushButton("ğŸ›« èµ·é£")
        self.land_btn = QPushButton("ğŸ›¬ é™è½")
        self.emergency_btn = QPushButton("ğŸ›‘ ç´§æ€¥åˆ¶åŠ¨")
        self.hover_btn = QPushButton("â¸ï¸ æ‚¬åœ")
        self.launch_btn = QPushButton("âœˆï¸ æŠ›é£")
        for btn in [self.takeoff_btn, self.land_btn, self.emergency_btn, self.hover_btn, self.launch_btn]:
            btn.setStyleSheet("""
                QPushButton {
                    background-color: #28A745;
                    color: white;
                    border-radius: 5px;
                    padding: 10px;
                    border: none;
                    box-shadow: 2px 2px 4px rgba(0, 0, 0, 0.3);
                }
                QPushButton:hover {
                    background-color: #218838;
                }
                QPushButton:pressed {
                    background-color: #1e7e34;
                    box-shadow: 1px 1px 2px rgba(0, 0, 0, 0.3);
                }
            """)
            left_layout.addWidget(btn)

        # æ¨¡å¼åˆ‡æ¢
        self.gesture_switch = QPushButton("ğŸ‘ æ‰‹åŠ¿æ§åˆ¶å¼€å…³")
        self.gesture_switch.clicked.connect(self.show_gesture_control_dialog)
        self.voice_switch = QPushButton("ğŸ¤ è¯­éŸ³æ§åˆ¶å¼€å…³")
        self.voice_switch.clicked.connect(self.show_voice_control_dialog)
        self.green_ball_tracking = QPushButton("ç»¿çƒè·Ÿè¸ªğŸ”µ")
        self.face_tracking = QPushButton("äººè„¸è·Ÿè¸ªğŸ‘¤")
        for btn in [self.gesture_switch, self.voice_switch, self.green_ball_tracking, self.face_tracking]:
            btn.setStyleSheet("""
                QPushButton {
                    background-color: #007BFF;
                    color: white;
                    border-radius: 5px;
                    padding: 10px;
                    border: none;
                    box-shadow: 2px 2px 4px rgba(0, 0, 0, 0.3);
                }
                QPushButton:hover {
                    background-color: #0056b3;
                }
                QPushButton:pressed {
                    background-color: #003d82;
                    box-shadow: 1px 1px 2px rgba(0, 0, 0, 0.3);
                }
            """)
            left_layout.addWidget(btn)

        self.left_panel.setLayout(left_layout)
        self.left_dock.setWidget(self.left_panel)
        self.addDockWidget(Qt.LeftDockWidgetArea, self.left_dock)

        # å³ä¾§å‚æ•°é¢æ¿
        self.right_dock = QDockWidget("å‚æ•°è®¾ç½®")
        self.right_panel = QWidget()
        right_layout = QVBoxLayout()
        right_layout.setSpacing(10)
        right_layout.setContentsMargins(10, 10, 10, 10)

        # é€Ÿåº¦è°ƒèŠ‚
        speed_label = QLabel("é€Ÿåº¦è°ƒèŠ‚ï¼š")
        speed_label.setStyleSheet("font-size: 14px; color: white;")
        speed_layout = QHBoxLayout()
        self.speed_slider = QSlider(Qt.Horizontal)
        self.speed_slider.setRange(0, 100)
        self.speed_value_label = QLabel("0%")
        self.speed_value_label.setStyleSheet("font-size: 14px; color: white;")
        speed_layout.addWidget(self.speed_slider)
        speed_layout.addWidget(self.speed_value_label)
        right_layout.addWidget(speed_label)
        right_layout.addLayout(speed_layout)

        # æ­¥é•¿è®¾ç½®
        step_label = QLabel("æ­¥é•¿è®¾ç½®ï¼š")
        step_label.setStyleSheet("font-size: 14px; color: white;")
        step_layout = QHBoxLayout()
        self.step_slider = QSlider(Qt.Horizontal)
        self.step_slider.setRange(10, 100)
        self.step_value_label = QLabel("10cm")
        self.step_value_label.setStyleSheet("font-size: 14px; color: white;")
        step_layout.addWidget(self.step_slider)
        step_layout.addWidget(self.step_value_label)
        right_layout.addWidget(step_label)
        right_layout.addLayout(step_layout)

        # å»¶æ—¶æ—¶é—´è®¾ç½®
        delay_label = QLabel("å»¶æ—¶æ—¶é—´è®¾ç½®ï¼š")
        delay_label.setStyleSheet("font-size: 14px; color: white;")
        delay_layout = QHBoxLayout()
        self.delay_slider = QSlider(Qt.Horizontal)
        self.delay_slider.setRange(1, 10)
        self.delay_value_label = QLabel("1s")
        self.delay_value_label.setStyleSheet("font-size: 14px; color: white;")
        delay_layout.addWidget(self.delay_slider)
        delay_layout.addWidget(self.delay_value_label)
        self.delay_slider.valueChanged.connect(self.update_delay_label)
        right_layout.addWidget(delay_label)
        right_layout.addLayout(delay_layout)

        # é«˜çº§è®¾ç½®
        advanced_label = QLabel("é«˜çº§è®¾ç½®ï¼š")
        advanced_label.setStyleSheet("font-size: 14px; color: white;")
        self.posture_switch = QPushButton("ä½“æ€æ§åˆ¶å¼€å…³")
        self.capture_btn = QPushButton("ğŸ“¸âºï¸ æ‹ç…§/å½•åƒ")
        self.capture_btn.setContextMenuPolicy(Qt.CustomContextMenu)
        self.capture_btn.customContextMenuRequested.connect(self.show_capture_menu)
        for btn in [self.posture_switch, self.capture_btn]:
            btn.setStyleSheet("""
                QPushButton {
                    background-color: #FFC107;
                    color: white;
                    border-radius: 5px;
                    padding: 10px;
                    border: none;
                    box-shadow: 2px 2px 4px rgba(0, 0, 0, 0.3);
                }
                QPushButton:hover {
                    background-color: #e0a800;
                }
                QPushButton:pressed {
                    background-color: #d39e00;
                    box-shadow: 1px 1px 2px rgba(0, 0, 0, 0.3);
                }
            """)
        right_layout.addWidget(advanced_label)
        right_layout.addWidget(self.posture_switch)
        right_layout.addWidget(self.capture_btn)

        self.right_panel.setLayout(right_layout)
        self.right_dock.setWidget(self.right_panel)
        self.addDockWidget(Qt.RightDockWidgetArea, self.right_dock)

        # åº•éƒ¨æ—¥å¿—æ 
        self.log_label = QLabel("ç³»ç»Ÿæ¶ˆæ¯å°†æ˜¾ç¤ºåœ¨è¿™é‡Œ")
        self.log_label.setStyleSheet("font-size: 14px; color: white; padding: 5px;")
        self.statusBar().addPermanentWidget(self.log_label)

        # è®¾ç½®æ ·å¼
        font = QFont()
        font.setFamily("Segoe UI")
        font.setPointSize(10)
        self.setFont(font)

        self.setStyleSheet("""
            QMainWindow {
                background-color: #212529;
                color: #FFFFFF;
            }
        """)

        self.setGeometry(100, 100, 800, 600)
        self.setWindowTitle("æ— äººæœºæ§åˆ¶ç•Œé¢")
        self.show()

    def update_delay_label(self):
        value = self.delay_slider.value()
        self.delay_value_label.setText(f"{value}s")

    def show_capture_menu(self, pos):
        menu = QMenu()
        immediate_action = menu.addAction("ç«‹å³æ‹ç…§")
        delayed_action = menu.addAction("å»¶æ—¶æ‹ç…§")
        action = menu.exec_(self.capture_btn.mapToGlobal(pos))
        if action == immediate_action:
            self.take_photo()
        elif action == delayed_action:
            delay = self.delay_slider.value()
            QTimer.singleShot(delay * 1000, self.take_photo)
            self.log_label.setText(f"å°†åœ¨ {delay} ç§’åæ‹ç…§...")

    def take_photo(self):
        try:
            # æ¨¡æ‹Ÿæ‹ç…§éŸ³æ•ˆ
            QSound.play("camera_shutter.wav")
            self.log_label.setText("æ‹ç…§æˆåŠŸï¼ç…§ç‰‡å·²ä¿å­˜ã€‚")
        except Exception as e:
            self.log_label.setText(f"æ‹ç…§å¤±è´¥ï¼š{str(e)}")

    def show_voice_control_dialog(self):
        dialog = VoiceControlDialog()
        dialog.exec_()

    def show_gesture_control_dialog(self):
        dialog = GestureControlDialog()
        dialog.exec_()

if __name__ == '__main__':
    app = QApplication(sys.argv)
    window = MainWindow()
    sys.exit(app.exec_())
